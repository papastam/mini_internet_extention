{% extends "base.html" %}
{% from 'macros.html' import update_message, h1 %}

{% block head %}
{{super()}}
{% if update_frequency %}
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta http-equiv="refresh" content="{{update_frequency}}" />
{% endif %}
<script>
    // overflow-x-auto needs a fixed width to work; the only way I found to make
    // it responsive was not css but by using js. Sadly.
    function resize_pre() {
        let w_menu = document.getElementById("menu").offsetWidth;
        let w_body = document.getElementById("lg-body").offsetWidth;
        // 48px equals padding px-6
        let target_size = Math.min(w_body, w_menu) - 48;
        document.getElementById("code").style.width = target_size + "px";
    }

    window.onload = resize_pre;
    window.onresize = resize_pre;
</script>
{% endblock %}

{% block body %}
<div id="lg-body" class="tw-max-w-4xl tw-mx-auto tw-px-6 tw-pt-6 tw-mb-16">
    {{ h1("looking glass") }}

    <blockquote class="tw-relative tw-m-4 tw-mb-8 tw-p-4 tw-text-md tw-border-l-4 tw-bg-neutral-100 tw-text-neutral-700 tw-border-neutral-400">
        <p class="tw-italic tw-quote tw-mb-4">
            Looking Glass servers (LG servers) are servers on the Internet running one of a variety of publicly
            available Looking Glass software implementations. They are commonly deployed by autonomous systems (AS) to
            offer access to their routing infrastructure in order to facilitate debugging network issues. A Looking
            Glass server is accessed remotely for the purpose of viewing routing information. Essentially, the server
            acts as a limited, read-only portal to routers of whatever organization is running the LG server.
        </p>
        <cite>
            <a href="https://en.wikipedia.org/wiki/Looking_Glass_server" class="tw-flex tw-items-center tw-not-italic">
                <img alt="avatar" class="tw-w-12 tw-mr-4 tw-rounded-full"
                    src="https://upload.wikimedia.org/wikipedia/commons/6/63/Wikipedia-logo.png" />
                <div class="tw-flex tw-flex-col">
                    <span class="tw-text-md tw-text-neutral-800 ">Looking Glass Server</span>
                    <span class="tw-text-sm tw-text-neutral-500 ">wikipedia.org</span>
                </div>
            </a>
        </cite>
    </blockquote>
    <div class="tw-flex tw-items-center tw-justify-center">
        <div class="tw-mr-8 tw-mb-4">
            <span class="tw-font-bold">AS</span>
            <select class="tw-bg-transparent tw-border-0 tw-border-b-2 tw-border-neutral-400 hover:tw-border-[#ff7e79]"
                onchange="if (this.value) window.location.href=this.value">
                {% for _group in dropdown_groups|sort %}
                <option {% if _group==group %}selected{%endif%}
                    value="{{url_for('looking_glass', group=_group, router=router)}}">
                    {{_group}}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="tw-mb-4">
            <span class="tw-font-bold">Router</span>
            <select class="tw-bg-transparent tw-border-0 tw-border-b-2 tw-border-neutral-400 hover:tw-border-[#ff7e79]"
                onchange="if (this.value) window.location.href=this.value">
                {% for _router in dropdown_routers %}
                <option {% if _router==router %}selected{%endif%}
                    value="{{url_for('looking_glass', group=group, router=_router)}}">
                    {{_router}}
                </option>
                {% endfor %}
            </select>
        </div>

    </div>

    <pre id="code"
        class="tw-box-border tw-w-48 tw-text-sm tw-px-4 tw-py-2 tw-rounded tw-border tw-border-neutral-300 tw-bg-neutral-100 tw-overflow-x-auto tw-mb-6">{{filecontent|safe}}</pre>

    {% if gao_rexford == "1" %}
        {{ h1("policy analysis") }}
        {{ update_message(update_frequency, last_updated)}}
        {% if not bgp_hints %}
        <p>
            The BGP advertisements of <b>AS {{group}}</b> do not seem to violate any policies.
        </p>
        {% else %}
        <p class="tw-mb-2">The BGP advertisements of <b>AS {{group}}</b> violate policies:</p>
        <ul class="tw-list-disc tw-list-inside">
            {% for msg in bgp_hints %}
            <li>{{msg}}</li>
            {% endfor %}
        </ul>
        {% endif %}
    {% endif %}
</div>
{% endblock %}